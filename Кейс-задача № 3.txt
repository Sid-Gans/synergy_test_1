import mysql.connector
from mysql.connector import Error

def create_tourism_database():
    try:
        # Подключаемся к серверу MySQL
        connection = mysql.connector.connect(
            host='localhost',
            user='your_username',
            password='your_password'
        )
        
        cursor = connection.cursor()
        
        # Создаем базу данных
        cursor.execute("CREATE DATABASE IF NOT EXISTS tourism")
        cursor.execute("USE tourism")
        
        # 1. Таблица клиентов (справочник)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS clients (
            client_id INT AUTO_INCREMENT PRIMARY KEY,
            first_name VARCHAR(50) NOT NULL,
            last_name VARCHAR(50) NOT NULL,
            passport_number VARCHAR(20) UNIQUE NOT NULL,
            phone VARCHAR(20) NOT NULL,
            email VARCHAR(100),
            registration_date DATE NOT NULL
        )
        """)
        
        # 2. Таблица туров (справочник)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS tours (
            tour_id INT AUTO_INCREMENT PRIMARY KEY,
            title VARCHAR(100) NOT NULL,
            country VARCHAR(50) NOT NULL,
            city VARCHAR(50) NOT NULL,
            description TEXT,
            duration_days INT NOT NULL,
            price DECIMAL(10, 2) NOT NULL,
            is_active BOOLEAN DEFAULT TRUE
        )
        """)
        
        # 3. Таблица услуг (справочник)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS services (
            service_id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(100) NOT NULL,
            description TEXT,
            price DECIMAL(10, 2) NOT NULL
        )
        """)
        
        # 4. Таблица сотрудников (справочник)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS employees (
            employee_id INT AUTO_INCREMENT PRIMARY KEY,
            first_name VARCHAR(50) NOT NULL,
            last_name VARCHAR(50) NOT NULL,
            position VARCHAR(50) NOT NULL,
            hire_date DATE NOT NULL,
            phone VARCHAR(20) NOT NULL
        )
        """)
        
        # 5. Таблица заказов (переменная информация)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS orders (
            order_id INT AUTO_INCREMENT PRIMARY KEY,
            client_id INT NOT NULL,
            tour_id INT NOT NULL,
            employee_id INT NOT NULL,
            order_date DATE NOT NULL,
            departure_date DATE NOT NULL,
            return_date DATE NOT NULL,
            total_price DECIMAL(12, 2) NOT NULL,
            status ENUM('new', 'confirmed', 'paid', 'cancelled') DEFAULT 'new',
            FOREIGN KEY (client_id) REFERENCES clients(client_id),
            FOREIGN KEY (tour_id) REFERENCES tours(tour_id),
            FOREIGN KEY (employee_id) REFERENCES employees(employee_id)
        )
        """)
        
        # Таблица связи заказов и услуг (многие ко многим)
        cursor.execute("""
        CREATE TABLE IF NOT EXISTS order_services (
            order_id INT NOT NULL,
            service_id INT NOT NULL,
            quantity INT DEFAULT 1,
            PRIMARY KEY (order_id, service_id),
            FOREIGN KEY (order_id) REFERENCES orders(order_id),
            FOREIGN KEY (service_id) REFERENCES services(service_id)
        )
        """)
        
        print("База данных 'tourism' успешно создана")
        
    except Error as e:
        print(f"Ошибка при работе с MySQL: {e}")
    finally:
        if connection.is_connected():
            cursor.close()
            connection.close()
            print("Соединение с MySQL закрыто")

# Вызываем функцию для создания базы данных
create_tourism_database()